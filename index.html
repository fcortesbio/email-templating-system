<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
<<<<<<< Updated upstream
    <style>
      body {
        font-family: sans-serif;
        padding: 1em;
      }
      .collapsible {
        cursor: pointer;
        padding: 5px;
        background: #f0f0f0;
        border: none;
        outline: none;
      }
      .content {
        display: none;
        padding-left: 20px;
      }
      .bold {
        font-weight: bold;
      }
      .task-list input {
        margin-right: 5px;
      }
      .copy-btn {
        margin: 5px;
      }
      .copied-msg {
        color: green;
        font-size: 0.9em;
        display: inline-block;
        margin-left: 10px;
        animation: fadeOut 2s forwards;
      }
      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          display: none;
        }
      }
    </style>
=======
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Email Templates</title>
    <?!= include('styles'); ?>
>>>>>>> Stashed changes
  </head>
  <body>
    <!-- Login Section -->
    <div id="login-section" class="section">
      <div class="login-container">
        <h1>Email Templates</h1>
        <p>Enter your Employee ID or Name to continue</p>
        <div class="input-group">
          <input
            type="text"
            id="user-input"
            placeholder="Employee ID or Name"
            aria-label="Employee ID or Name"
          />
          <button id="login-button" class="btn primary">Continue</button>
        </div>
        <p id="login-error" class="error-message"></p>
      </div>
    </div>

    <!-- Main App Section (hidden initially) -->
    <div id="app-section" class="section hidden">
      <header>
        <div class="header-content">
          <h1>Email Templates</h1>
          <div class="user-info">
            <span id="user-name"></span>
            <button id="about-button" class="btn small">?</button>
            <button id="logout-button" class="btn small">Logout</button>
          </div>
        </div>
      </header>

      <main>
        <div class="container">
          <div class="sidebar">
            <h2>Topics</h2>
            <div id="topics-menu" class="topics-menu"></div>
          </div>

<<<<<<< Updated upstream
      function submitLogin() {
        const input = document.getElementById("loginInput").value;
        google.script.run
          .withSuccessHandler((name) => {
            sessionStorage.setItem(userNameKey, name);
            renderApp();
          })
          .getUserFirstName(input);
      }
=======
          <div class="content">
            <div id="welcome-message" class="welcome-message">
              <h2>Welcome to Email Templates</h2>
              <p>Select a topic from the menu to view templates</p>
            </div>
>>>>>>> Stashed changes

            <div id="resolution-section" class="resolution hidden">
              <h2 id="resolution-title">Template Title</h2>

<<<<<<< Updated upstream
        google.script.run
          .withSuccessHandler((topics) => {
            const container = document.createElement("div");
            container.innerHTML = `<h2>Welcome, ${name}</h2>`;

            function createTree(node, parent) {
              Object.entries(node).forEach(([key, value]) => {
                const btn = document.createElement("button");
                btn.textContent = key;
                btn.className = "collapsible";

                const div = document.createElement("div");
                div.className = "content";

                btn.onclick = () => {
                  div.style.display =
                    div.style.display === "block" ? "none" : "block";
                };

                if (value.resolution) {
                  const res = value.resolution;
                  const resDiv = document.createElement("div");

                  // Tasks
                  const tasksHTML = res.tasks
                    .map(
                      (task) =>
                        `<label class='task-list'><input type='checkbox'/>${task}</label><br/>`
                    )
                    .join("");
                  resDiv.innerHTML += `<h4>Tasks:</h4>${tasksHTML}`;

                  // Backend note
                  resDiv.innerHTML += `<h4>Back-end Note:</h4><div>${res.backend_note}</div><button class='copy-btn' onclick='copyText(this.previousElementSibling, "${res.backend_note}")'>Copy</button>`;

                  // Subject
                  resDiv.innerHTML += `<h4>Email Subject:</h4><div>${res.email_subject}</div><button class='copy-btn' onclick='copyText(this.previousElementSibling, "${res.email_subject}")'>Copy</button>`;

                  // Email Body with placeholders replaced
                  let emailBody = res.email_body
                    .replaceAll("{{agent_name}}", name)
                    .replace(/xX(.*?)Xx/g, "<span class='bold'>xX$1Xx</span>");
                  resDiv.innerHTML += `<h4>Email Body:</h4><div contenteditable='true'>${emailBody}</div><button class='copy-btn' onclick='copyText(this.previousElementSibling, this.previousElementSibling.innerText)'>Copy</button>`;

                  div.appendChild(resDiv);
                } else {
                  createTree(value, div);
                }

                parent.appendChild(btn);
                parent.appendChild(div);
              });
            }

            createTree(topics, container);
            app.innerHTML = "";
            app.appendChild(container);
          })
          .getTopics();
      }

      function copyText(referenceElement, text) {
        navigator.clipboard.writeText(text).then(() => {
          const msg = document.createElement("span");
          msg.className = "copied-msg";
          msg.textContent = "Copied! ‚úÖ";
          referenceElement.insertAdjacentElement("afterend", msg);
          setTimeout(() => msg.remove(), 2000);
        });
      }

      const existing = sessionStorage.getItem(userNameKey);
      if (existing) renderApp();
      else renderLogin();
    </script>
=======
              <div class="resolution-content">
                <div class="tasks-section">
                  <h3>Tasks</h3>
                  <div id="tasks-container" class="tasks-container"></div>
                </div>

                <div class="template-section">
                  <div class="template-item">
                    <div class="template-header">
                      <h3>Backend Note</h3>
                      <button class="copy-btn" data-target="backend-note">
                        Copy
                      </button>
                    </div>
                    <div id="backend-note" class="template-content"></div>
                  </div>

                  <div class="template-item">
                    <div class="template-header">
                      <h3>Email Subject</h3>
                      <button class="copy-btn" data-target="email-subject">
                        Copy
                      </button>
                    </div>
                    <div id="email-subject" class="template-content"></div>
                  </div>

                  <div class="template-item">
                    <div class="template-header">
                      <h3>Email Body</h3>
                      <button class="copy-btn" data-target="email-body">
                        Copy
                      </button>
                    </div>
                    <div
                      id="email-body"
                      class="template-content"
                      contenteditable="true"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal hidden">
      <div class="modal-content">
        <span id="close-about" class="close-btn">&times;</span>
        <h2>About This App</h2>
        <p>
          <strong>Email Templating System</strong> is a secure, user-friendly
          web app built with <strong>Google Apps Script</strong>, designed to
          replace a bulky spreadsheet used by the
          <strong>Customer Solutions Tech team</strong>.
        </p>
        <ul>
          <li>üîç Quick login with name or Employee ID (EID)</li>
          <li>üìÇ Dynamic topic navigation</li>
          <li>üìã Task checklists for guidance</li>
          <li>üìù Editable templates with smart placeholders</li>
          <li>üìé One-click copy functionality</li>
          <li>üîê Secure, no external data access</li>
        </ul>
        <p>‚ù§Ô∏è With love, from Fabi.</p>
      </div>
    </div>

    <?!= include('scripts'); ?>
>>>>>>> Stashed changes
  </body>
</html>
